---
title: "Social"
author: "Sebastian"
date: "8/5/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('tidyverse')

```

################## MODELS #############################
Refer to:
https://arxiv.org/abs/1802.07068 (for the original article)

https://medium.com/@hongsupshin/talent-luck-and-success-simulating-meritocracy-and-inequality-with-stochasticity-501e0c1b4969 (for the tweaking)
The code follows this article's progression, so you can reproduce the similar data and the plots displayed every steps of the article.

Each models builds up on the preceding models.
The first one presented is the "standard" version. It is the one that is the most faithfull to the original article. It also serves as a template for all further tweaks that we will do. Therefore, it is heavily commented, whereas I only pointed out what changed in the other models.

Make Realistic Model
```{r}
### FUNCTION ###

#The role of the model is to explore the interplay between talent and luck in an economic world

#The model makes agents navigate an economic world with their talent. They all start with the same amount of money, 10.
#Each round, an event can happen to an agent. It can be good or bad.
#If a good event happens, the agent has to be smart enough to seize the opportunity, in which case it can double his money.
#If a bad event happens, the agent loses half of his money, no matter what.

#There is 3 parameters to the model:
#N : the number of agents
#tmax: how many timestep the model runs
#p_event: the probability for an event to happen

economy <- function(N,tmax,p_event){
  #first, we create an empty frame of agents of size N
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  
  #we initialize people's intelligence (normally distributed around 0.6 for 0.1 std)
  people$talent <- rnorm(N,0.6,0.1)
  #and capital (everyone gets the same)
  people$Kapital <- rep(10,N)
  
  #we create a matrix of events, each row correspond to an agent from the people's frame
  #each column represent time (up to tmax)
  #An event has p_event chance to happen to someone. If it happens, it has equal chance to be a good or a bad event 
  #Thus, p_event/2
  #A good event is written 1, a bad event event is written -1, and no event is written 0
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE, prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  #we extract the capital of agents in order to change it without modifying its value in the df
  capital <- people$Kapital
  #we create a new matrix that will hold people's capital as it evolves 
  mapital <- matrix(nrow = N, ncol = tmax)
  
  #we loop in time to provoke the events
  #at each time i, we take the column i of the event matrix
  #we then then change the capital accordingly to the type of event that happened
  for (i in 1:tmax){
    #First, if event = 0 (nothing happens), then capital doesn't change
    capital <- ifelse(type[,i] == 0,
                      capital,
                      #If type == 1 (event is good), create random number
                      ifelse(type[,i] == 1,
                             ifelse(runif(N) < people$talent,
                                    capital*2,
                                    #if random number > talent, capital stays the same
                            #(You were not smart enough to seize the opportunity)
                                    capital),
                            #If type =/= 1 and =/= 0 (it can only be -1), a bad event happens
                            #You lose half of your capital
                             capital*0.5))
    
    #We add the modifications to the matrix, referencing the economic history of all agents
    mapital[,i] <- capital
  }

  #Formating the final dataframe
  #We add people's financial history to the original df
  people <- cbind(people,mapital)
  #We add a column to precise what kind of model we are running (useful later one when we tweak)
  people$condition <- "standard"
  #We add a column to precise p_event to compare different p_event values
  people$p_event <- p_event
  
  return(people)
}

#### RUNS ####
#the standard model at different p_event values
eco_norm1 <- economy(10000,80,0.001)
eco_norm2 <- economy(10000,80,0.01)
eco_norm3 <- economy(10000,80,0.1)
eco_norm4 <- economy(10000,80,0.5)
eco_norm5 <- economy(10000,80,0.9)
#We put everything together to compare
eco_norm <- rbind(eco_norm1,eco_norm2,eco_norm3,eco_norm4,eco_norm5)

#### PLOTS ####
#talent distribution
ggplot(eco_norm, aes(x = talent)) + 
  geom_histogram(aes(y = ..density..), binwidth = 0.001)
#capital distribution in the end game for p = 0.1
ggplot(eco_norm3, aes(`80`)) +
  geom_histogram(binwidth = 20)
#relation between capital and talent for p = 0.1
ggplot(eco_norm3, aes(`80`, talent)) +
  geom_segment(aes(xend=`80`,alpha=0.1), yend=0) +
    expand_limits(y=0) +
  geom_point(color='red') +
  scale_x_continuous(trans='log10') #Log Scaled
```

BALANCED LUCK
Now, you can also escape bad events according to your talent.
```{r}
#### FUNCTION ####
economy_balanced <- function(N,tmax,p_event){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE,prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- ifelse(type[,i] == 0,
                      capital,
                      ifelse(type[,i] == 1,
                            ifelse(runif(N) < people$talent,
                                  capital*2,
                                  capital),
                            # /!\ /!\ CHANGE /!\ /!\ #
                            #However, if capital =/= 0 and capital =/= 1, then create a random number again
                            ifelse(runif(N) < people$talent,
                                   #If your talent is higher, you keep your capital standing
                                   capital,
                                   capital*0.5)))
    
    mapital[,i] <- capital
}

#Adding a few column for data viz' later on
people <- cbind(people,mapital)
people$condition <- "balanced"
people$p_event <- p_event

return(people)
}


#### RUNS ####
#the balanced model at different p values
eco_bal1 <- economy_balanced(10000,80,0.001)
eco_bal2 <- economy_balanced(10000,80,0.01)
eco_bal3 <- economy_balanced(10000,80,0.1)
eco_bal4 <- economy_balanced(10000,80,0.5)
eco_bal5 <- economy_balanced(10000,80,0.9)
#big dataframe to compare standard and balanced models
eco_NvsB <- rbind(eco_norm1,eco_norm2,eco_norm3,eco_norm4,eco_norm5,eco_bal1,eco_bal2,eco_bal3,eco_bal4, eco_bal5)


#### PLOTS ####
ggplot(eco_NvsB, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.1) +
  scale_y_continuous(trans='log10')+
  facet_wrap(~p_event) 
#LOG SCALED
```

TALENT BASED EVENT PAYOFF
Now results of events depend directly on your talent (capital\*talent for bad luck, capital\*(1+talent) for good luck)
```{r}
#### FUNCTION ####
economy_talent <- function(N,tmax,p_event){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE,prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){
    capital <- ifelse(type[,i] == 0,
                      capital,
                      ifelse(type[,i] == 1,
                            ifelse(runif(N) < people$talent,
                            # /!\ /!\ CHANGE /!\ /!\ #
                            #PS: remember, talent should be a number between 0 and 1
                            
                            #If you are smart enough, capital(t+1) = capital * 1.talent
                                  capital*(1+people$talent),
                                  capital),
                            ifelse(runif(N) < people$talent,
                                   capital,
                            #If you're not smart enough to get out of trouble, capital(t+1) = capital*talent
                                   capital*people$talent)))
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "talent"
  people$p_event <- p_event
  
  return(people)
}


#### RUNS ####
#the talent model at different p_values
eco_tal1 <- economy_talent(10000,80,0.001)
eco_tal2 <- economy_talent(10000,80,0.01)
eco_tal3 <- economy_talent(10000,80,0.1)
eco_tal4 <- economy_talent(10000,80,0.5)
eco_tal5 <- economy_talent(10000,80,0.9)
#big dataframe to compare balanced and talent models
eco_BvsT <- rbind(eco_bal1,eco_bal2,eco_bal3,eco_bal4,eco_bal5,eco_tal1,eco_tal2,eco_tal3,eco_tal4,eco_tal5)


#### PLOTS ####
ggplot(eco_BvsT, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.1) +
  scale_y_continuous(trans='log10')+
  facet_wrap(~p_event)
```

MERITOCRATIC PAYCHECK
Now, when nothing happens, your capital still increases each turn. You get a salary.
The salary is dependent on your talent (w*talent).
```{r}
#### FUNCTION ####
#new variable: w = the base value of the yearly wage for all agents
economy_meritopay <- function(N,tmax,p_event,w){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE,prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  for (i in 1:tmax){
    capital <- ifelse(type[,i] == 0,
                      # /!\ /!\ CHANGE /!\ /!\ #
                      #If event == 0, you just get your usual salary
                      #the smarter you are, the higher your salary
                      #capital(t+1) = capital + wage*talent
                      capital+w*people$talent,
                      ifelse(type[,i] == 1,
                            ifelse(runif(N) < people$talent,
                                  capital*(1+people$talent),
                                  capital),
                            ifelse(runif(N) < people$talent,
                                   capital,
                                   capital*people$talent)))
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "paycheck"
  people$p_event <- p_event
  people$w <- w
return(people)
}
#### RUNS ####
#the meritocratic paycheck model at different wage
eco_pay1 <- economy_meritopay(10000,80,0.1,0.01)
eco_pay2 <- economy_meritopay(10000,80,0.1,0.1)
eco_pay3 <- economy_meritopay(10000,80,0.1,1)
eco_pay4 <- economy_meritopay(10000,80,0.1,5)
eco_pay5 <- economy_meritopay(10000,80,0.1,10)
eco_pay <- rbind(eco_pay1,eco_pay2,eco_pay3,eco_pay4,eco_pay5)

#the meritocratic paycheck model at different p values
eco_pay6 <- economy_meritopay(10000,80,0.001,1)
eco_pay7 <- economy_meritopay(10000,80,0.01,1)
eco_pay8 <- economy_meritopay(10000,80,0.1,1)
eco_pay9 <- economy_meritopay(10000,80,0.5,1)
eco_pay10 <- economy_meritopay(10000,80,0.9,1)
#big dataframe to compare talent and paycheck model
eco_TvsP <- rbind(eco_pay6,eco_pay7,eco_pay8,eco_pay9,eco_pay10)
eco_TvsP <- eco_TvsP %>% 
  select(-w)
eco_TvsP <- rbind(eco_TvsP,eco_tal1,eco_tal2,eco_tal3,eco_tal4,eco_tal5)

#### PLOTS ####
#relation between paycheck and inequality (with fix event rate at 0.1)
ggplot(eco_pay, aes(talent,`80`)) +
  geom_point(alpha=0.1, size=0.5, color="blue") +
  scale_y_continuous(trans='log10')+
  facet_wrap(~w)
#comparing the talent based model to the meritocratic paycheck one (with fix w = 1)
ggplot(eco_TvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
```

INTEREST RATE
Now, the capital is increased every turn according to an interest rate.
```{r}
#### FUNCTION ####
#new variable: r = interest rate upon which your capital increases every time step
economy_interest <- function(N,tmax,p_event,w,r){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE,prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  for (i in 1:tmax){
    
     # /!\ /!\ CHANGE /!\ /!\ #
    #add your interest rate at the beginning of a timestep, no matter what
    capital <- capital + capital*r

    capital <- ifelse(type[,i] == 0,
                      capital+w*people$talent,
                      ifelse(type[,i] == 1,
                            ifelse(runif(N) < people$talent,
                                  capital*(1+people$talent),
                                  capital),
                            ifelse(runif(N) < people$talent,
                                   capital,
                                   capital*people$talent)))
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "interest"
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of r with no paycheck w=0
eco_int1 <- economy_interest(10000,80,0.1,0,0.001)
eco_int2 <- economy_interest(10000,80,0.1,0,0.01)
eco_int3 <- economy_interest(10000,80,0.1,0,0.1)
eco_int4 <- economy_interest(10000,80,0.1,0,0.2)
eco_int5 <- economy_interest(10000,80,0.1,0,0.25)
eco_int <- rbind(eco_int1,eco_int2,eco_int3,eco_int4,eco_int5)
#runs for different values of r with a paycheck of w=1
eco_int6 <- economy_interest(10000,80,0.1,1,0.001)
eco_int7 <- economy_interest(10000,80,0.1,1,0.01)
eco_int8 <- economy_interest(10000,80,0.1,1,0.1)
eco_int9 <- economy_interest(10000,80,0.1,1,0.2)
eco_int10 <- economy_interest(10000,80,0.1,1,0.25)
eco_intW <- rbind(eco_int6,eco_int7,eco_int8,eco_int9,eco_int10)
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_int11 <- economy_interest(10000,80,0.001,1,0.1)
eco_int12 <- economy_interest(10000,80,0.01,1,0.1)
eco_int13 <- economy_interest(10000,80,0.1,1,0.1)
eco_int14 <- economy_interest(10000,80,0.5,1,0.1)
eco_int15 <- economy_interest(10000,80,0.9,1,0.1) 
#big dataframe to compare paycheck and interest model
eco_PvsI <- rbind(eco_int11,eco_int12,eco_int13,eco_int14,eco_int15)
eco_PvsI <- eco_PvsI %>% 
  select(-r)
eco_PvsI <- rbind(eco_PvsI,eco_pay6,eco_pay7,eco_pay8,eco_pay9,eco_pay10)

#### PLOTS ####
#different r value without any paycheck
ggplot(eco_int, aes(talent,`80`)) +
  geom_point(alpha=0.1, color="blue") +
  scale_y_continuous(trans='log10')+
  facet_grid(~r)
#different r value with paycheck of w=1
ggplot(eco_intW, aes(talent,`80`)) +
  geom_point(alpha=0.1, color="blue") +
  scale_y_continuous(trans='log10')+
  facet_wrap(~r)
#comparing the paycheck model to the interest rate one (with fix w = 1 and fix r = 0.1)
ggplot(eco_PvsI, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
```

POORTAX
A ghetto tax/poortax the phenomenon of people with low incomes, particularly those living in poverty-stricken areas, paying higher prices for goods and services. (crappy shoes - terry pratchett - shoes quote "Vimes")
https://en.wikipedia.org/wiki/Ghetto_tax
```{r}
#Again we add a new variable: poor_tax_range -> the range of possible tax you can get, the poorest will have to pay the highest number, while the richest will have to pay the lowest number. 0.01 to 0.1 means you have to pay between 0.1% and 10% of your profit every round.
economy_poortax <- function(N,tmax,p_event,w,r, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
     # /!\ /!\ BIG CHANGES /!\ /!\ #
    #We calculate z scores and cumulative probabilites, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #After caculating people's profit for this time step, you add it to their capital while adding taxes
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains * (1-.1)) #if one's profit is negative u still get taxed as poor
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "poortax"
  people$tax_range <- 0
  people$ubi <- 0
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_poortax1 <- economy_poortax(10000,80,0.001,1,0.1)
eco_poortax2 <- economy_poortax(10000,80,0.01,1,0.1)
eco_poortax3 <- economy_poortax(10000,80,0.1,1,0.1)
eco_poortax4 <- economy_poortax(10000,80,0.5,1,0.1)
eco_poortax5 <- economy_poortax(10000,80,0.9,1,0.1) 
#big dataframe to compare tax and interest model
eco_PTvsI <- rbind(eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5, eco_int11,eco_int12,eco_int13,eco_int14,eco_int15)

#### PLOTS ####
#comparing the tax model to the interest rate one (with fix w = 1 and fix r = 1)
ggplot(eco_PTvsI, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event) 
###### Maybe facetwrap it to include non poortax'ing
```











### STARTING MODELS

SOCIAL SAFETY NET
Now, capital cannot decrease below the starting rate
```{r}
#### FUNCTION ####
economy_safenet <- function(N,tmax,p_event,w,r, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE,prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){
    capital <- capital + capital*r
    
    # /!\ /!\ BIG CHANGES /!\ /!\ #
    #We calculate z scores and cumulative probabilites, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))

   #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))

    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains * (1-0.1)) #if one's profit is negative u still get taxed as poor
    
    # /!\ /!\ CHANGE /!\ /!\ #
    #If you go below the starting value, we give you enough to get back there
    capital <- ifelse(capital < 10, 10, capital)
    #After caculating people's profit for this time step, you add it to their capital while adding taxes
    
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "safety"
  people$tax_range <- 0
  people$ubi <- 0 
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_safe1 <- economy_safenet(10000,80,0.001,1,0.1)
eco_safe2 <- economy_safenet(10000,80,0.01,1,0.1)
eco_safe3 <- economy_safenet(10000,80,0.1,1,0.1)
eco_safe4 <- economy_safenet(10000,80,0.5,1,0.1)
eco_safe5 <- economy_safenet(10000,80,0.9,1,0.1) 
#big dataframe to compare paycheck and interest model
eco_SNvsP <- rbind(eco_safe1,eco_safe2,eco_safe3,eco_safe4,eco_safe5, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5)

#### PLOTS ####
#comparing the paycheck model to the interest rate one (with fix w = 1 and fix r = 0.1)
ggplot(eco_SNvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_wrap(~p_event)
```

TAX SYSTEM MODEL
Now, a tax system is in place.
***********This one is a bit different from the one in the article, in the sense that taxes are calculated on profit, not capital***************
```{r}
#### FUNCTION ####
#here, new variable: tax_range -> the range of possible tax you can get, the poorest will have to pay the lowest number, while the richest will have to pay the highest number. 0.1 to 0.4 means you have to pay between 10% and 40% of your profit every round.
economy_tax <- function(N,tmax,p_event,w,r, tax_range = c(.0, .45), poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    # /!\ /!\ BIG CHANGES /!\ /!\ #
    #We calculate z scores and cumulative probabilites, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    
    #we calculate the taxes you have to pay
    #if probability is very low, your taxes are very close to the lower boundaries
    #if probability is very high, your taxes are close to the higher boundaries
    #examples: for tax range of 0.1 - 0.4, if prob = 0.01, tax = 0.1 + 0.3*0.01 = 0.103
    #for tax range of 0.1 - 0.4, if prob = 0.99, tax = 0.1 + 0.3*0.99 = 0.397
    tax = tax_range[1] + diff(tax_range) * prob
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #After caculating people's profit for this time step, you add it to their capital while substracting taxes
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains * (1-0.1)) #if one's profit is negative u still get taxed as poor
    
    mapital[,i] <- capital
  }

  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "tax"
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_tax1 <- economy_tax(10000,80,0.001,1,0.1)
eco_tax2 <- economy_tax(10000,80,0.01,1,0.1)
eco_tax3 <- economy_tax(10000,80,0.1,1,0.1)
eco_tax4 <- economy_tax(10000,80,0.5,1,0.1)
eco_tax5 <- economy_tax(10000,80,0.9,1,0.1) 
#big dataframe to compare tax and interest model
eco_TvsP <- rbind(eco_tax1,eco_tax2,eco_tax3,eco_tax4,eco_tax5, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5)

#### PLOTS ####
#comparing the tax model to the interest rate one (with fix w = 1 and fix r = 1)
ggplot(eco_TvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
```




WEALTH REDISTRIBUTION MODEL
In the previous tax model, taxes just disappear...
Using the taxes collected, you can redistribute wealth equally amongst citizens. Much better than a social safety net. I've put in a little "State maintainance fee of 10%, meaning that having the state running costs something aswell.)
```{r}
#### FUNCTION ####
economy_distribution <- function(N,tmax,p_event,w,r,tax_range, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(N,10)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = tax_range[1] + diff(tax_range) * prob
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains * (1-0.1)) #if one's profit is negative u still get taxed as poor
    
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    # redistribute the wealth equally! Everyone gets an equal piece of the total government tax earnings
    capital = capital + ((government_tax_earnings / N))
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "Wealth Dist"
  people$tax_range <- tax_range[2] ##########################################<3############
  people$ubi <- 0
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_dist1_2 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .2))
eco_dist2_2 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .2))
eco_dist3_2 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .2))
eco_dist4_2 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .2))
eco_dist5_2 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .2)) 

eco_dist1_3 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .3))
eco_dist2_3 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .3))
eco_dist3_3 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .3))
eco_dist4_3 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .3))
eco_dist5_3 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .3)) 

eco_dist1_4 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .4))
eco_dist2_4 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .4))
eco_dist3_4 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .4))
eco_dist4_4 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .4))
eco_dist5_4 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .4)) 

eco_dist1_5 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_5 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_5 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_5 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_5 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .5)) 

eco_dist1_6 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .6))
eco_dist2_6 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .6))
eco_dist3_6 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .6))
eco_dist4_6 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .6))
eco_dist5_6 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .6)) 

eco_dist1_7 <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .7))
eco_dist2_7 <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .7))
eco_dist3_7 <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .7))
eco_dist4_7 <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .7))
eco_dist5_7 <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .7))

#Making a model that can be compared to the UBI model
eco_dist1_U <- economy_distribution(10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_U <- economy_distribution(10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_U <- economy_distribution(10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_U <- economy_distribution(10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_U <- economy_distribution(10000,80,0.9,1,0.1, tax_range = c(.0, .5))

#big dataframe to compare distribution and interest model
eco_TDvsP <- rbind(eco_dist1_2,eco_dist2_2,eco_dist3_2,eco_dist4_2,eco_dist5_2,eco_dist1_3,eco_dist2_3,eco_dist3_3,eco_dist4_3,eco_dist5_3,eco_dist1_4,eco_dist2_4,eco_dist3_4,eco_dist4_4,eco_dist5_4,eco_dist1_5,eco_dist2_5,eco_dist3_5,eco_dist4_5,eco_dist5_5,eco_dist1_6,eco_dist2_6,eco_dist3_6,eco_dist4_6,eco_dist5_6,eco_dist1_7,eco_dist2_7,eco_dist3_7,eco_dist4_7,eco_dist5_7, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5)

#### PLOTS ####
#comparing the distribution model to the interest rate one (with fix w = 1 and fix r = 0.1)
ggplot(eco_TDvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(p_event~tax_range)
#Include On Poor Tax In every model - Good baseline to show how wealthdistribution actually helps A LOT LOT
```

UBI
In the earlier wealth redistribution, the taxes were divided equally between all citizens (imagine infrastructure, hospitalcare etc.), but I also put on a little tax to maintain the state. So in this round we'll just give them a fixed "living wage", as this should be a set amount not only dependent on the taxes collected at a given timestamp. One could add some of the governmental taxes to the individuals capital awswell, but due to the added UBI, that would create an exponentially growing society, as the ubi is added to mix every round in this model.
https://works.bepress.com/widerquist/75/
The Cost  Of UBI
50% tax *0.85 = 42.5
```{r}
#### FUNCTION ####
economy_ubi <- function(N,tmax,p_event,w,r,ubi, ubitax_range, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = ubitax_range[1] + diff(ubitax_range) * prob
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains* (1-0.1))#if one's profit is negative u still get taxed as poor
    #We calculate people's new capital according to profit and tax rate
     
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    
    # The Government Tax Earning stay get a 15% subtraction are and a flat UBI rate is given out.
    capital = capital + ubi + (((government_tax_earnings/50)*42.5) / N)
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "ubi"
  people$tax_range <- 0
  people$ubi <- ubi
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_ubi1_1 <- economy_ubi(10000,80,0.001,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi2_1 <- economy_ubi(10000,80,0.01,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi3_1 <- economy_ubi(10000,80,0.1,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi4_1 <- economy_ubi(10000,80,0.5,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi5_1 <- economy_ubi(10000,80,0.9,1,0.1, ubi = 1,ubitax_range = c(.0, .5)) 

eco_ubi1_5 <- economy_ubi(10000,80,0.001,1,0.1, ubi = 5,ubitax_range = c(.0, .5))
eco_ubi2_5 <- economy_ubi(10000,80,0.01,1,0.1, ubi = 5,ubitax_range = c(.0, .5))
eco_ubi3_5 <- economy_ubi(10000,80,0.1,1,0.1, ubi = 5,ubitax_range = c(.0, .5))
eco_ubi4_5 <- economy_ubi(10000,80,0.5,1,0.1, ubi = 5,ubitax_range = c(.0, .5))
eco_ubi5_5 <- economy_ubi(10000,80,0.9,1,0.1, ubi = 5,ubitax_range = c(.0, .5)) 

eco_ubi1_10 <- economy_ubi(10000,80,0.001,1,0.1, ubi = 10,ubitax_range = c(.0, .5))
eco_ubi2_10 <- economy_ubi(10000,80,0.01,1,0.1, ubi = 10,ubitax_range = c(.0, .5))
eco_ubi3_10 <- economy_ubi(10000,80,0.1,1,0.1, ubi = 10,ubitax_range = c(.0, .5))
eco_ubi4_10 <- economy_ubi(10000,80,0.5,1,0.1, ubi = 10,ubitax_range = c(.0, .5))
eco_ubi5_10 <- economy_ubi(10000,80,0.9,1,0.1, ubi = 10,ubitax_range = c(.0, .5)) 

#big dataframe to look at UBI's
eco_UBI <- rbind(eco_ubi1_1,eco_ubi2_1,eco_ubi3_1,eco_ubi4_1,eco_ubi5_1,eco_ubi1_5,eco_ubi2_5,eco_ubi3_5,eco_ubi4_5,eco_ubi5_5,eco_ubi1_10,eco_ubi2_10,eco_ubi3_10,eco_ubi4_10,eco_ubi5_10, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5)
#big dataframe to compare ubi and poortax model
eco_UBIvsP <- rbind(eco_ubi1_1,eco_ubi2_1,eco_ubi3_1,eco_ubi4_1,eco_ubi5_1,eco_ubi1_5,eco_ubi2_5,eco_ubi3_5,eco_ubi4_5,eco_ubi5_5,eco_ubi1_10,eco_ubi2_10,eco_ubi3_10,eco_ubi4_10,eco_ubi5_10, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5)
#big dataframe to compare ubi to distribution model
eco_UBIvsDist <- rbind(eco_ubi1_1,eco_ubi2_1,eco_ubi3_1,eco_ubi4_1,eco_ubi5_1,eco_ubi1_5,eco_ubi2_5,eco_ubi3_5,eco_ubi4_5,eco_ubi5_5,eco_ubi1_10,eco_ubi2_10,eco_ubi3_10,eco_ubi4_10,eco_ubi5_10, eco_dist1_U,eco_dist2_U,eco_dist3_U,eco_dist4_U,eco_dist5_U)

#### PLOTS ####
#Look at the UBI
ggplot(eco_UBI, aes(talent,`80`, color=ubi)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
#comparing the ubi model to the poortax one (with fix w = 1 and fix r = 1)
ggplot(eco_UBIvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(p_event~ubi)
#comparing the distribution model to the ubi one (with fix w = 1 and fix r = 1)
ggplot(eco_UBIvsDist, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(p_event~ubi)
```










#Capitalism
```{r}
#### FUNCTION ####
#Capitalism on Wealth Dist
economy_distribution_cap <- function(N,tmax,p_event,w,r,tax_range, capitalism_range = .4, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(N,10)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = tax_range[1] + diff(tax_range) * prob
    #Adding Capitalism
    capitalism <- case_when(
      prob < 0.8 ~ capitalism_range,
      prob >= 0.8 ~ 0,
      TRUE ~ pnorm(z_score))
    
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)*(1-poortax)*(1-capitalism),
      capital_gains <= 0 ~ capital + capital_gains * (1-0.1)* (1-capitalism)) #if one's profit is negative u still get taxed as poor
    
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    # redistribute the wealth equally! Everyone gets an equal piece of the total government tax earnings
    #We calculate the total earnings from the capitalism
    capitalism_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (capitalism),
      capital_gains <= 0 ~ 0))
    # redistribute the wealth equally! Everyone gets an equal piece of the total government tax earnings
    capital = capital + ((government_tax_earnings / N))
    
    #Distribute Capitalism to top 20%
    capital = case_when(
      prob < 0.8 ~ capital,
      prob >= 0.8 ~ capital + (capitalism_earnings/(N*0.2)),
      TRUE ~ pnorm(z_score))
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "Wealth Dist + Capitalism"
  people$tax_range <- tax_range[2] ##########################################<3############
  people$ubi <- 0
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1

eco_dist1_cap <- economy_distribution_cap(10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_cap <- economy_distribution_cap(10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_cap <- economy_distribution_cap(10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_cap <- economy_distribution_cap(10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_cap <- economy_distribution_cap(10000,80,0.9,1,0.1, tax_range = c(.0, .5)) 

#big dataframe to compare distribution and interest model
eco_capvsP <- rbind(eco_dist1_cap,eco_dist2_cap,eco_dist3_cap,eco_dist4_cap,eco_dist5_cap, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5,eco_dist1_U,eco_dist2_U,eco_dist3_U,eco_dist4_U,eco_dist5_U,eco_poortax1_cap,eco_poortax2_cap,eco_poortax3_cap,eco_poortax4_cap,eco_poortax5_cap)

#### PLOTS ####
#comparing the distribution model to the interest rate one (with fix w = 1 and fix r = 0.1)
ggplot(eco_capvsP, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
#Include On Poor Tax In every model - Good baseline to show how wealthdistribution actually helps A LOT LOT















#UBI
#### FUNCTION ####
economy_ubi_cap <- function(N,tmax,p_event,w,r,ubi, ubitax_range, capitalism_range = .4, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = ubitax_range[1] + diff(ubitax_range) * prob
    #Adding Capitalism
    capitalism <- case_when(
      prob < 0.8 ~ capitalism_range,
      prob >= 0.8 ~ 0,
      TRUE ~ pnorm(z_score))
    
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax)*(1-capitalism),
      capital_gains <= 0 ~ capital + capital_gains* (1-0.1)*(1-capitalism))#if one's profit is negative u still get taxed as poor
    #We calculate people's new capital according to profit and tax rate
     
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    
    #We calculate the total earnings from the capitalism
    capitalism_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (capitalism),
      capital_gains <= 0 ~ 0))
    
    # The Government Tax Earning stay get a 15% subtraction are and a flat UBI rate is given out.
    capital = capital + ubi + (((government_tax_earnings/50)*42.5) / N)
    
    #Distribute Capitalism to top 20%
    capital = case_when(
      prob < 0.8 ~ capital,
      prob >= 0.8 ~ capital + (capitalism_earnings /(N*0.2)),
      TRUE ~ pnorm(z_score))
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "ubi + capitalism"
  people$tax_range <- 0
  people$ubi <- ubi
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_ubi1_cap <- economy_ubi_cap(10000,80,0.001,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi2_cap <- economy_ubi_cap(10000,80,0.01,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi3_cap <- economy_ubi_cap(10000,80,0.1,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi4_cap <- economy_ubi_cap(10000,80,0.5,1,0.1, ubi = 1,ubitax_range = c(.0, .5))
eco_ubi5_cap <- economy_ubi_cap(10000,80,0.9,1,0.1, ubi = 1,ubitax_range = c(.0, .5)) 


#big dataframe to look at UBI before and after Capitalism + A baseline of the poortax model
eco_UBI_Cap <- rbind(eco_ubi1_1,eco_ubi2_1,eco_ubi3_1,eco_ubi4_1,eco_ubi5_1,eco_ubi1_cap,eco_ubi2_cap,eco_ubi3_cap,eco_ubi4_cap,eco_ubi5_cap, eco_poortax1,eco_poortax2,eco_poortax3,eco_poortax4,eco_poortax5,eco_poortax1_cap,eco_poortax2_cap,eco_poortax3_cap,eco_poortax4_cap,eco_poortax5_cap)

#### PLOTS ####
#comparing the distribution model to the ubi one (with fix w = 1 and fix r = 1)
ggplot(eco_UBI_Cap, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)













### EXTRA
# POOR Tax + Capitalism
economy_poortax_cap <- function(N,tmax,p_event,w,r, capitalism_range = .4, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
     # /!\ /!\ BIG CHANGES /!\ /!\ #
    #We calculate z scores and cumulative probabilites, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      std == 0.85 ~ .8,
      TRUE ~ pnorm(z_score))
    
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
   #Adding Capitalism
    capitalism <- case_when(
      prob < .8 ~ capitalism_range,
      prob >= .8 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #After caculating people's profit for this time step, you add it to their capital while adding taxes
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-poortax)*(1-capitalism),
      capital_gains <= 0 ~ capital + capital_gains * (1-.1)*(1-capitalism)) #if one's profit is negative u still get taxed as poor
    print(capitalism)
    #We calculate the total earnings from the capitalism
    capitalism_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (capitalism),
      capital_gains <= 0 ~ 0))
    
    #Distribute Capitalism to top 20%
    capital = case_when(
      prob < .8 ~ capital,
      prob >= .8 ~ capital + (capitalism_earnings /(N*0.2)),
      TRUE ~ pnorm(z_score))
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "poortax + Capitalism"
  people$tax_range <- 0
  people$ubi <- 0
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_poortax1_cap <- economy_poortax_cap(1000,1,0.001,1,0.1)
eco_poortax2_cap <- economy_poortax_cap(10000,80,0.01,1,0.1)
eco_poortax3_cap <- economy_poortax_cap(10000,80,0.1,1,0.1)
eco_poortax4_cap <- economy_poortax_cap(10000,80,0.5,1,0.1)
eco_poortax5_cap <- economy_poortax_cap(10000,80,0.9,1,0.1) 


```








#Influence Equality
UNEVEN STARTINGPOINT
the paper and the scenarios above assume everyone starts with the same amount of capital. What will happen if the amount of capital is a random number drawn from a distribution? Uniform, normal, poisson or log-normal?
```{r}
#Standard Dist of 10 For everyone
plot(rep(10,10000))

#######Wealth Distribution#########
###Wealth Model
economy_distribution_UNEQST <- function(K,L,N,tmax,p_event,w,r,tax_range, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- L
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = tax_range[1] + diff(tax_range) * prob
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains * (1-0.1)) #if one's profit is negative u still get taxed as poor
    
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    # redistribute the wealth equally! Everyone gets an equal piece of the total government tax earnings
    capital = capital + ((government_tax_earnings / N))
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "Wealth Dist"
  people$tax_range <- tax_range[2] ##########################################<3############
  people$ubi <- 0
  people$p_event <- p_event
  people$w <- w
  people$r <- r
  people$K <- K
return(people)
}



#### RUNS ####
#Normal plot(rnorm(10000,10,2)) rnorm(N,10,2)
eco_dist1_N <- economy_distribution_UNEQST(K ="Normal", L = rnorm(10000,10,2),10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_N <- economy_distribution_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_N <- economy_distribution_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_N <- economy_distribution_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_N <- economy_distribution_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.9,1,0.1, tax_range = c(.0, .5)) 
#Poisson plot(rpois(10000,10)) rpois(N,10)
eco_dist1_P <- economy_distribution_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_P <- economy_distribution_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_P <- economy_distribution_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_P <- economy_distribution_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_P <- economy_distribution_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.9,1,0.1, tax_range = c(.0, .5)) 
#Log plot(rlnorm(1000,log(10),log(3))) rlnorm(N,log(10),log(4)) #standard deviation of 4
eco_dist1_L <- economy_distribution_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.001,1,0.1, tax_range = c(.0, .5))
eco_dist2_L <- economy_distribution_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.01,1,0.1, tax_range = c(.0, .5))
eco_dist3_L <- economy_distribution_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.1,1,0.1, tax_range = c(.0, .5))
eco_dist4_L <- economy_distribution_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.5,1,0.1, tax_range = c(.0, .5))
eco_dist5_L <- economy_distribution_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.9,1,0.1, tax_range = c(.0, .5)) 

#big dataframe to look at UBI before and after Capitalism + A baseline of the poortax model
eco_Dist_UNEQST <- rbind(eco_dist1_N,eco_dist2_N,eco_dist3_N,eco_dist4_N,eco_dist5_N,eco_dist1_P,eco_dist2_P,eco_dist3_P,eco_dist4_P,eco_dist5_P,eco_dist1_L,eco_dist2_L,eco_dist3_L,eco_dist4_L,eco_dist5_L)

#### PLOTS ####
#comparing the distribution model to the ubi one (with fix w = 1 and fix r = 1)
ggplot(eco_Dist_UNEQST, aes(talent,`80`, color=K)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)






#######UBI#########
#Normal plot(rnorm(10000,10,2)) rnorm(N,10,2)
#Poisson plot(rpois(10000,10)) rpois(N,10)
#Log plot(rlnorm(1000,log(10),log(3))) rlnorm(100,log(10),log(4)) #standard deviation of 4
#### FUNCTION ####
#UBI
economy_ubi_UNEQST <- function(K,L,N,tmax,p_event,w,r,ubi, ubitax_range, poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  type <- matrix(sample(c(1,-1,0),
                         tmax*N,
                         replace = TRUE, 
                         prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)

  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We calculate z scores, cumulative probabilites and tax rate, as in the previous model
    m <- mean(capital)
    std <- sd(capital)
    z_score <- (capital - m) / std
    prob = case_when(
      std == 0 ~ .5,
      TRUE ~ pnorm(z_score))
    tax = ubitax_range[1] + diff(ubitax_range) * prob
    #we calculate the poortaxes you have to pay
    #if probability is above the mean, you have no taxes
    #if probability is very low, your taxes are close to the higher boundaries
   poortax <- case_when(
      prob <= .5 ~ poortax_range[2] - diff(poortax_range) * prob *2,
      prob > .5 ~ 0,
      TRUE ~ pnorm(z_score))
    
    #We calculate people's profit according to the usual system developped in earlier models
    capital_gains = case_when(
      type[,i] == 0 ~ w*people$talent,
      
      type[,i] == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(people$talent),
                                  0),
      
      type[,i] == -1 ~ ifelse(runif(N) < people$talent,
                                  0,
                                  capital*(people$talent - 1)))
    
    #We calculate people's new capital according to profit and tax rate
    capital = case_when(
      capital_gains > 0 ~ capital + capital_gains * (1-tax)* (1-poortax),
      capital_gains <= 0 ~ capital + capital_gains* (1-0.1))#if one's profit is negative u still get taxed as poor
    #We calculate people's new capital according to profit and tax rate
     
    #We calculate the total earnings from the taxes
    government_tax_earnings = sum(case_when(
      capital_gains > 0 ~ capital_gains * (tax),
      capital_gains <= 0 ~ 0))
    
    # The Government Tax Earning stay get a 15% subtraction are and a flat UBI rate is given out.
    capital = capital + ubi + (((government_tax_earnings/50)*42.5) / N)
    
    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "ubi"
  people$tax_range <- 0
  people$ubi <- ubi
  people$p_event <- p_event
  people$w <- w
  people$r <- r
  people$K <- K
return(people)
}

#### RUNS ####
#Normal plot(rnorm(10000,10,2)) rnorm(N,10,2)
eco_ubi1_N <- economy_ubi_UNEQST(K ="Normal", L = rnorm(10000,10,2),10000,80,0.001,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi2_N <- economy_ubi_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.01,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi3_N <- economy_ubi_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.1,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi4_N <- economy_ubi_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.5,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi5_N <- economy_ubi_UNEQST(K ="Normal",L = rnorm(10000,10,2),10000,80,0.9,1,0.1,  ubi = 1,ubitax_range = c(.0, .5)) 
#Poisson plot(rpois(10000,10)) rpois(N,10)
eco_ubi1_P <- economy_ubi_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.001,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi2_P <- economy_ubi_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.01,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi3_P <- economy_ubi_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.1,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi4_P <- economy_ubi_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.5,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi5_P <- economy_ubi_UNEQST(K ="Poisson",L = rpois(10000,10),10000,80,0.9,1,0.1,  ubi = 1,ubitax_range = c(.0, .5)) 
#Log plot(rlnorm(1000,log(10),log(3))) rlnorm(N,log(10),log(4)) #standard deviation of 4
eco_ubi1_L <- economy_ubi_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.001,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi2_L <- economy_ubi_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.01,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi3_L <- economy_ubi_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.1,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi4_L <- economy_ubi_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.5,1,0.1,  ubi = 1,ubitax_range = c(.0, .5))
eco_ubi5_L <- economy_ubi_UNEQST(K ="Log",L = rlnorm(10000,log(10),log(4)),10000,80,0.9,1,0.1,  ubi = 1,ubitax_range = c(.0, .5)) 

#big dataframe to look at UBI before and after Capitalism + A baseline of the poortax model
eco_UBI_UNEQST <- rbind(eco_ubi1_N,eco_ubi2_N,eco_ubi3_N,eco_ubi4_N,eco_ubi5_N,eco_ubi1_P,eco_ubi2_P,eco_ubi3_P,eco_ubi4_P,eco_ubi5_P,eco_ubi1_L,eco_ubi2_L,eco_ubi3_L,eco_ubi4_L,eco_ubi5_L)

#### PLOTS ####
#comparing the distribution model to the ubi one (with fix w = 1 and fix r = 1)
ggplot(eco_UBI_UNEQST, aes(talent,`80`, color=K)) +
  geom_point(alpha=0.15,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
```











# Index's
```{r}
#Make GDP and Growth function
SuperCapital <- function(df, taxlevel, Chances){
datatime<- filter(df, tax_range == taxlevel, p_event == Chances)

#print(unique(datatime$tax_range))
#print(unique(datatime$p_event))
#print(length(datatime$ID))
#print(colnames(datatime))

datatime1 = datatime[c(3:83)]
#print(colnames(datatime))
GDP = colSums(datatime1)

Growth = c(0,rep(NA,80))
for (i in 2:81){
Growth[i] = (GDP[i]/GDP[i-1] - 1) * 100
}

ecostuff <- cbind(GDP,Growth, taxlevel,Chances)
#ecostuff <- data.frame(ecostuff)
#merge(ecostuff_final, ecostuff, c("GDP","Growth","taxlevel","Chances"))
return(ecostuff)
}

#End Dataframe
ecostuff_final <- data.frame()
GDP <- 0
Growth <- 0
taxlevel <- 0
Chances <- 0
ecostuff_final <- cbind(GDP, Growth, taxlevel, Chances)
ecostuff_final

#Make Lists
Taxielevels = c(0.2, 0.3, 0.4, 0.5, 0.6, 0.7) 
ChancieLevels = c(0.001,0.01,0.1,0.5,0.9)
df = eco_TDvsP

#Loop In Loop
for (c in ChancieLevels){ #loop over list of files
for (t in Taxielevels){ #loop over list of files
cool <- SuperCapital(df, t, c)
cool <- data.frame(cool)
ecostuff_final <- rbind(ecostuff_final,cool)  
}}
#Remove First Line
ecostuff_final <- ecostuff_final[-1, ]
view(ecostuff_final)

#Trial
#cool <- SuperCapital(eco_TDvsP,0.3,0.1)
#cool <- data.frame(cool)
#plot(cool$Growth)

```






#Simulations

```{r}
#The role of the model is to explore the interplay between talent and luck in an economic world

#The model makes agents navigate an economic world with their talent. They all start with the same amount of money, 10.
#Each round, an event can happen to an agent. It can be good or bad.
#If a good event happens, the agent has to be smart enough to seize the opportunity, in which case it can double his money.
#If a bad event happens, the agent loses half of his money, no matter what.

#There is 3 parameters to the model:
#N : the number of agents
#tmax: how many timestep the model runs
#p_event: the probability for an event to happen

economy <- function(N,tmax,p_event){
  #first, we create an empty frame of agents of size N
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  
  #we initialize people's intelligence (normally distributed around 0.6 for 0.1 std)
  people$talent <- rnorm(N,0.6,0.1)
  #and capital (everyone gets the same)
  people$Kapital <- rep(10,N)
  
  #we create a matrix of events, each row correspond to an agent from the people's frame
  #each column represent time (up to tmax)
  #An event has p_event chance to happen to someone. If it happens, it has equal chance to be a good or a bad event (thus, p_event/2)
  #A good event is written 1, a bad event event is written -1, and no event is written 0
  type <- matrix(sample(c(1,-1,0),tmax*N, replace = TRUE, prob = c(p_event/2,p_event/2,(1-p_event))), nrow = N)
  
  #we extract the capital of agents in order to change it without modifying its value in the df
  capital <- people$Kapital
  #we create a new matrix that will hold people's capital as it evolves 
  mapital <- matrix(nrow = N, ncol = tmax)
  
  #we loop in time to provoke the events
  #at each time i, we take the column i of the event matrix
  #we then then change the capital accordingly to the type of event that happened
  for (i in 1:tmax){
    #First, if event = 0 (nothing happens), then capital doesn't change
    capital <- ifelse(type[,i] == 0,
                      capital,
                      #If type == 1 (event is good), create random number
                      ifelse(type[,i] == 1,
                             ifelse(runif(N) < people$talent,
                                    capital*2,
                                    #if random number > talent, capital stays the same
                            #(You were not smart enough to seize the opportunity)
                                    capital),
                            #If type =/= 1 and =/= 0 (it can only be -1), a bad event happens
                            #You lose half of your capital
                             capital*0.5))
    
    #We add the modifications to the matrix, referencing the economic history of all agents
    mapital[,i] <- capital
  }

  #Formating the final dataframe
  #We add people's financial history to the original df
  people <- cbind(people,mapital)
  #We add a column to precise what kind of model we are running (useful later one when we tweak)
  people$condition <- "standard"
  #We add a column to precise p_event to compare different p_event values
  people$p_event <- p_event
  
  return(people)
}

#### RUNS ####
#the standard model at different p_event values
eco_norm1 <- economy(10000,80,0.001)
eco_norm2 <- economy(10000,80,0.01)
eco_norm3 <- economy(10000,80,0.1)
eco_norm4 <- economy(10000,80,0.5)
eco_norm5 <- economy(10000,80,0.9)
#We put everything together to compare
eco_norm <- rbind(eco_norm1,eco_norm2,eco_norm3,eco_norm4,eco_norm5)

#### PLOTS ####
#talent distribution
dens(eco_norm$talent)
#capital distribution in the end game for p = 0.1
ggplot(eco_norm3, aes(`80`)) +
  geom_histogram(binwidth = 20)
#relation between capital and talent for p = 0.1
ggplot(eco_norm3, aes(`80`, talent)) +
  geom_segment(aes(xend=`80`,alpha=0.1), yend=0) +
    expand_limits(y=0) +
  geom_point(color='red') +
  scale_x_continuous(trans='log10')

### MULTIPLE SIMULATIONS
#Firstly, we maybe don't need so many simulations since there isn't much difference in such a little system and we're interested in the final spread at timestamp 80 that doesn't vary much
#This Functions add n-number of runs through the simulation
XXX <- function(N,tmax,p_event,ngames){
  game <- economy(N,tmax,p_event)
  game$ngame <- 1
  for (i in 2:ngames) {
    anothergame <- economy(N,tmax,p_event)
    anothergame$ngame <- i
    game <- rbind(game,anothergame)
  }
  return(game)
}
lol <- XXX(100,80,0.01,2)
#Run with eco_norm1 <- economy(10000,80,0.001,XXXXX)
#Plot different games
#Average over runs - average over the distribution of wealth of all the runs at turn 80 - Make a slope for the average progression
```








#TO ASK RICARDO
# Why 50%
https://en.wikipedia.org/wiki/List_of_countries_by_tax_rates
- Russia, USA, Denmark, England around 50 today

#For my Poortax and Captalism - How Do I make take only the buttom 50 or 80%?
------> 0.85
https://sixsigmastudyguide.com/wp-content/uploads/2014/04/z-table.jpg 

#How Do I get an idea of the actual outcome variables -> At the end
Talent -> 
INEQUALITY -> scatter on Y-axis


#How Do I make a trajectory for one or a few agents?
"""
----Tjajectory for one talented person----
ggplot(eco_norm3, aes(`80`)) +
  geom_point()+geom_line()
people$talented <- (ifelse(Talent <= 0.8, "HT", "L"))
people$dumb <- (ifelse(Talent >= 0.4, "D", "H"))

#I've made a loop to make multiple universes / Simulations - Is it necessary?
Ricardo -> Yes, for the rapport - really good idea
#How Do I plot across simulations?
Just plot runs in different colors

#In the UBI model I could Divide the Government income by the participants*UBI, so as to see if there were actually some taxes to give?
Explicit - not connected to taxes- this is how it works
long term 
Risk now - In Italy 


"""
#Har ikke motiveret mine STD i Log og Norm modellen
Show how it looks like
```{r}
plot(rep(10,10000))
plot(rnorm(10000,10,2))
plot(rpois(10000,10))
plot(rlnorm(100,log(10),log(4))) #standard deviation of 3
```

#How Do I go About Writing Such An Article? It seems very exploratory all of it
Theorydriven
Start with problem of inequality (Certain ideologies - meritocracy -> everyone can become doctor) (All sort of inequalities - agent based simulation, not to say what is the case, but to make the qualitative rile -> If luck plays a big role, what would happen - But we are not indepent individuals in the society - What are the effect of retribution on talent (meritocracy), median income - every have it good)
- Paragrpah for all the parameters

What is the relative role of talent and luck in wealth and inequality
talk about manipulation top-down (Taxonomy) - So we went and looked for possible dimensions - here are the dimensions (Find a reviewpaper -> "When we look at the literature, these are keydimensions")
- Discussion -> This is a first exploratory study, next step Would be smart do a systematic review to find all the best parameters
# Choose one Taxlevels To On With - Just justify it -> We go with DK, because that where I live and study and are influenced 


#Make Realistic Model
#Events happen and people get a paycheck (V)
#Talent influences luck on events (V)
#Talent influences paycheck (V)
#Influenced by interest rate (V)
#PoorTax (V)

#Make more Equal
#Social Safety Net (Builds up to "Redistribute Wealth")
#Tax system (Builds up to "Redistribute Wealth")
#Redistribute Wealth (V)
https://en.wikipedia.org/wiki/List_of_countries_by_tax_rates
#UBI (V)
- Fixed Rule: Doesn't have enough at the start, but will eventually -Fixed Rule - The State Is Gonna Be In Debt


#Influence Equality 
#Influenced by Capitalism (V)
-inverse redistribution - most money - more is redistributed (Subtraction and addition % of tax residstributions)
-> extract Tax, Extract Exploit, Redistribute (Tax to everyone and Exploit out to to top 20%)
- The system of Exploitation -> Under a fixed level (Fall below 0.8 on Z-score - (80/20 - look into the former study)) - Exploited in a big way -> You need to make tax variable. (0-1 -> UBI to save us)
- every turn everything goes into a pool (Seperate into salaries, taxsystem, and invester profits (Profit precentage))
-Rich get richer (Update probability for bad events dependent on how many money is in the taxes)
- Profits, taxes and salaries
- Use the pooortax setup

#Influenced by uneven Starting point (V)
- following individual people - Begining to end
- poison distribution
- library(rethinking)
- dens(rpois(10000,10))
- people$Kapital <- rpois(N,10)


#MORE
#Influenced by rich people getting luckier 
(normally distributed around 0.6 for 0.1 std) -> Why this?
Why start with 10? How to change for spread? rnorm(N,10,2)?

How would you plot single participants and their progressions?
#Moving On - Look At debt (Bankin system, natural disasters)





Question for arnault

Visualy exploring the progress of some very talented and very untalented / very lucky and very unlucky people in all the different model?

Extract a row and plot
Plot with all participants  (Gradient color by talent or luck)


What makes most sense
Raising tax's by e.g. 5% to fund UBI (Take a bit out of taxe - debt now but equal out later)
or just having a flat UBI




# Motivation of investigation
http://www.oecd.org/g20/topics/employment-and-social-policy/The-Labour-Share-in-G20-Economies.pdf
Figure 6

#Discussion
Models lack Investment
"It might be argued that lower wages are necessary to boost profits in order to increase
investment and, in turn, job creation. However, in developed economies, the shift in
income away from labour towards capital has not produced the expected results on
investment. Between 2000 and 2007, the capital share in advanced G20 countries grew
by close to 2 percentage points. In contrast, investment as percentage of GDP did not
keep pace and remained stable (from 22.4 per cent in 2000 to 22.8 per cent in 2007). "

The Talented become more lucky, so In the caotic system they double their money more and thereby inflate the total amunt of money in the simulation















































######EXTRA######


RICH GET LUCKIER
Now, rich agents have a greater chance for an event to be a good event.
On the other side, poor agents have a harder time getting lucky
```{r}
#### FUNCTION ####
economy_richluck <- function(N,tmax,p_event,w,r,poortax_range = c(.001, .1)){
  people <-  as_tibble(matrix(rep(1:N),N,1))
  colnames(people) <- c("ID")
  people$talent <- rnorm(N,0.6,0.1)
  people$Kapital <- rep(10,N)
  
  # /!\ /!\ BIG CHANGES /!\ /!\ #
  #Now probabilities of events are dynamic (depend on the previous timesteps) and individual
  #therefore, we cannot generate all events happenning in time at once
  # ==> we cannot use the "type" matrix previously used, and need to generate events in the loop
  #This means worse performances and longer time to run.
  
  capital <- people$Kapital
  mapital <- matrix(nrow = N,ncol = tmax)
  for (i in 1:tmax){

    capital <- capital + capital*r
    
    #We extract the mean capital and standard deviation before a timestep
    m <- mean(capital)
    std <- sd(capital)
    #We calculate standardized z scores in order to rank everyone's capital according to the mean and standard deviation
    z_score <- (capital - m) / std
    #and we calculate everyone's probability of good event using the cumulative probability function. The higher your capital is, the higher your z score is, and the closer to 1 your probability will be. If your capital is the same as the mean capital, your z score is 0 and your probability is 0.5. 
    prob_luck = case_when(
      std == 0 ~ 0.5, #if everyone has the same capital, std == 0, therefore it's random
      TRUE ~ pnorm(z_score))
    
    #here, you create the event vector, where probability of good and bad events depends on the individual probability value calculated above
    event = purrr::map_dbl(prob_luck, ~ sample(c(1,-1,0), 1, replace = TRUE,
                                         prob = c(p_event * .x, p_event * (1-.x), 1-p_event)))

    #case_when is a simple way to make conditional statements.
    #Syntax is sexier than using cascades of ifelse. Thanks Malte for pointing it out!
    capital = case_when(
      #if no event
      event == 0 ~ capital+w*people$talent,
      #if good event
      event == 1 ~ ifelse(runif(N) < people$talent,
                                  capital*(1+people$talent),
                                  capital),
      #if bad eevent
      event == -1 ~ ifelse(runif(N) < people$talent,
                                  capital,
                                  capital*people$talent))

    mapital[,i] <- capital
  }
  
  #Adding a few column for data viz' later on
  people <- cbind(people,mapital)
  people$condition <- "richluck"
  people$p_event <- p_event
  people$w <- w
  people$r <- r
return(people)
}

#### RUNS ####
#runs for different values of p_events with a paycheck of w=1 and an interest rate of r=0.1
eco_richluck1 <- economy_richluck(10000,80,0.001,1,0.1)
eco_richluck2 <- economy_richluck(10000,80,0.01,1,0.1)
eco_richluck3 <- economy_richluck(10000,80,0.1,1,0.1)
eco_richluck4 <- economy_richluck(10000,80,0.5,1,0.1)
eco_richluck5 <- economy_richluck(10000,80,0.9,1,0.1) 
#big dataframe to compare richluck and interest model
eco_RLvsI <- rbind(eco_richluck1,eco_richluck2,eco_richluck3,eco_richluck4,eco_richluck5, eco_int11,eco_int12,eco_int13,eco_int14,eco_int15)

#### PLOTS ####
#comparing the richluck model to the interest rate one (with fix w = 1 and fix r = 1)
ggplot(eco_RLvsI, aes(talent,`80`, color=condition)) +
  geom_point(alpha=0.5,size=0.1) +
  scale_y_continuous(trans='log10')+
  facet_grid(~p_event)
```